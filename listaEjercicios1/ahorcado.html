<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Ahorcado</title>
    <script>
        var ahorcado = {
            palabras: [
                'Lazo',
                'Perro',
                'Zorro',
                'Gato',
                'Elefante',
                'Mandril',
                'Leon',
                'Capital de España'
            ],
            palabra: "",
            intentos: 6,
            letrasErradas: [],
            //Seleciona una palabra de la lista de forma aleatoria
            elegirPalabraRandom: function () {
                let random = Math.floor(Math.random() * this.palabras.length);
                let palabra = this.palabras[random];
                ahorcado.palabra = palabra.toUpperCase();
                //console.log("Hola");
            },
            //Crea la vista de botones sin letras
            crearDashes: function () {
                document.querySelector('#ahorcado').innerHTML = "";
                let arr = this.palabra.split('');
                arr.forEach(letra => {
                    if (letra == " ") document.querySelector('#ahorcado').innerHTML += `<button style="width:auto;visibility:hidden">_</button>`;
                    else document.querySelector('#ahorcado').innerHTML += `<button style="width:auto;">_</button>`;
                });
            },
            //Comprueba que la palabra contiene la letra, y muestra en la vista de botones sus instancias
            comprobarMostrarLetra: function () {
                let letra = document.querySelector('#letra').value.toUpperCase();

                let palabra = this.palabra;
                if (palabra.indexOf(letra) >= 0) {
                    let i = 0;
                    while (palabra.indexOf(letra, i) >= 0) {
                        let index = palabra.indexOf(letra, i);
                        document.querySelectorAll('#ahorcado button')[index].innerHTML = letra;
                        i = index + 1;
                    }
                } else {
                    if (ahorcado.letrasErradas.indexOf(letra) == -1) ahorcado.letrasErradas.push(letra);
                    this.intentos--;
                }

            },
            //Muestra una lista con las letras en que hemos errado porque la palabra no las contiene
            mostrarLetrasErradas: function () {
                let salida = `Letras erradas: `;
                ahorcado.letrasErradas.forEach(letra => {
                    salida += letra;
                })
                document.querySelector('#salida').innerHTML += salida;
            },
            //Comprueba el numero de intentos que quedan y muestra la imagen correspondiente
            comprobarIntentos: function () {
                document.querySelector('#intentos').innerHTML = `<img style="width:8rem;height:auto" src="img/ahorcado_${this.intentos}.png"/>`;
                if (this.intentos == 0) {
                    document.querySelector('#compLetra').disabled = true;
                    document.querySelector('#compPalabra').disabled = true;
                    ahorcado.perdedor();

                } else {
                    document.querySelector('#compLetra').disabled = false;
                    document.querySelector('#compPalabra').disabled = false;
                }
            },
            //Muestra el mensaje de ganador
            ganador: function () {
                let salida = "Has ganado!";
                document.querySelector('#salida').innerHTML = salida;
            },
            //Realiza varias funciones cuando pierdas: desactiva botones, muestra mensaje de perdedor
            perdedor: function () {
                let salida = "Has perdido!";
                document.querySelector('#salida').innerHTML = salida;
            },
            //Empieza el juego
            empezar: function () {
                ahorcado.intentos = 6;
                ahorcado.elegirPalabraRandom();
                ahorcado.crearDashes();
                ahorcado.comprobarIntentos();
                document.querySelector('#salida').innerHTML = "";
            },
            //Realiza todas la funciones nesarias cuando se comprueba una letra en el juego
            comprobarLetra: function () {
                document.querySelector('#salida').innerHTML = "";
                let letra = document.querySelector('#letra').value;
                if (/^[a-zA-ZñÑ]{1}$/.test(letra)) {
                    ahorcado.comprobarMostrarLetra();
                    ahorcado.mostrarLetrasErradas();
                    ahorcado.comprobarIntentos();
                } else {
                    let salida = "Escribre solo una letra";
                    document.querySelector('#salida').innerHTML += salida;
                }
            },
            //Comprueba si la palabra del juego introducida es correcta o no.
            comprobarPalabra: function () {
                document.querySelector('#salida').innerHTML = "";
                let palabra = document.querySelector('#palabra').value.toUpperCase();
                if (/^[a-zA-ZñÑ ]{1,}$/.test(palabra)) {
                    if (ahorcado.palabra == palabra) {
                        ahorcado.ganador();
                    } else {
                        ahorcado.intentos = 0;
                        ahorcado.comprobarIntentos();
                    }
                } else {
                    let salida = "Escribre una sola palabra";
                    document.querySelector('#salida').innerHTML += salida;
                }
            }

        }
        onload = () => {
            document.querySelector('#empezar').onclick = ahorcado.empezar;
            document.querySelector('#compLetra').onclick = ahorcado.comprobarLetra;
            document.querySelector('#compPalabra').onclick = ahorcado.comprobarPalabra;
        }
    </script>
</head>

<body>
    <h1>Ahorcado</h1>
    <form action="#" method="post" onsubmit="return false;">
        <p id="intentos" style="float:right;z-index:3;"></p>
        <p id="ahorcado"></p>
        <p>
            Letra: <input type="text" name="letra" id="letra">
        </p>
        <p>
            Palabra: <input type="text" name="palabra" id="palabra">
        </p>
        <button id="empezar">Empezar juego</button>
        <button id="compLetra" disabled>Comprobar letra</button>
        <button id="compPalabra" disabled>Comprobar palabra</button>

    </form>
    <p id="salida"></p>
</body>

</html>